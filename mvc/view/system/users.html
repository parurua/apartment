{% extends '../common/layout.html' %}
{% block breadcrumb %}
<li>
    <a href="/users">系统管理</a>
</li>
<li class="active">
    <span class="Current_page">
        登录用户管理
    </span>
</li>
{% endblock %}
{% block content %}
<div class="page-content clearfix">
    <div id="Member_Ratings">
        <div class="d_Confirm_Order_style">
            <div class="search_style" style="height: 100px;">
                <div class="title_names">操作</div>
                <ul class="search_content clearfix">
                    <li><a href="#" onclick="member_add()" id="member_add"
                           class="btn btn-warning"><i class="icon-plus"></i>添加用户</a></li>
                </ul>
            </div>

            <div class="table_menu_list">
                <table class="table table-striped table-bordered table-hover" id="sample-table">
                    <thead>
                    <tr>
                        <th>用户名</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>手机</th>
                        <th>邮箱</th>
                        <th>权限</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for user in users %}
                    <tr>
                        <td>
                            <u class="text-primary">{{user.username}}</u>
                        </td>
                        <td>{{user.name}}</td>
                        <td>{{user.sex}}</td>
                        <td>{{user.phone}}</td>
                        <td>{{user.email}}</td>
                        <!--<td>{{user.createTime | date('Y-m-d H:i:s',-480)}}</td>-->
                        <td>
                            {% if user.adminFlag == '1'%}
                            管理员
                            {% else %}
                            一般用户
                            {% endif %}
                        </td>
                        <td class="td-manage">
                            <a title="编辑" href="javascript:;" onclick="member_edit('{{user.username}}')"
                               class="btn btn-xs btn-info"><i class="icon-edit bigger-120"></i></a>
                            <a title="删除" href="javascript:;" onclick="member_del(this,'{{user.username}}')"
                               class="btn btn-xs btn-warning"><i class="icon-trash  bigger-120"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    jQuery(function ($) {
        var oTable1 = $('#sample-table').dataTable({
            "bStateSave": true,//状态保存
            "aoColumnDefs": [
                {"orderable": false, "aTargets": [6]}// 制定列不参与排序
            ]
        });
    });

    /*用户-添加*/
    function member_add() {
        $.ajax({
            type: "GET",
            url: "/users/add",
            dataType: "html",
            success: function (data) {
                layer.open({
                    type: 1,
                    title: '添加用户',
                    maxmin: true,
                    shadeClose: false, //点击遮罩关闭层
                    area: ['800px', ''],
                    content: data,
                    btn: ['提交', '取消'],
                    yes: function (index, layero) {
                        //表单验证
                        if ($('#user_add_form').parsley().validate()) {
                            $.ajax({
                                type: "POST",
                                url: "/users/add",
                                data: $('#user_add_form').serializeObject(),
                                dataType: "json",
                                success: function (data) {
                                    location.href = '/users';
                                }
                            });
                            layer.close(index);
                        } else {
                            var msg = $('#element').html();
                            if(msg)
                            layer.alert(msg, {
                                title: '提示框',
                                icon: 0
                            });
                        }

                    }
                });
            }
        });
    }
    /*用户-编辑*/
    function member_edit(id) {

        $.ajax({
            type: "GET",
            url: "/users/edit/" + id,
            dataType: "html",
            success: function (data) {
                layer.open({
                    type: 1,
                    title: '修改用户',
                    maxmin: true,
                    shadeClose: false, //点击遮罩关闭层
                    area: ['800px', ''],
                    content: data,
                    btn: ['提交', '取消'],
                    yes: function (index, layero) {

                        //表单验证
                        var vf = $('#user_edit_form').parsley().validate();
                        if (vf) {
                            $.ajax({
                                type: "POST",
                                url: "/users/edit/" + id,
                                data: $('#user_edit_form').serializeObject(),
                                dataType: "json",
                                success: function (data) {
                                    location.href = '/users';
                                }
                            });
                            layer.close(index);
                        } else {
                            var msg = $('#element').html();
                            layer.alert(msg, {
                                title: '提示框',
                                icon: 0
                            });
                        }
                    }
                });
            }
        });
    }
    /*用户-删除*/
    function member_del(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $.ajax({
                type: "GET",
                url: "/users/delete/" + id,
                dataType: "json",
                success: function (data) {
                    //$(obj).parents("tr").remove();
                    //layer.msg('已删除!', {icon: 1, time: 1000});
                    location.href = '/users';
                }
            });
        });
    }
</script>